@model IEnumerable<PetServices.Models.CartItem>

@{
    ViewData["Title"] = "Checkout";
    decimal grandTotal = Model.Sum(x => x.Service.Price * x.Quantity);
}

<div class="container mt-5">
    <h2 class="text-center mb-4">🧾 Checkout</h2>

    <div class="card p-4 shadow-sm">
        <form asp-action="Checkout" method="post" id="checkoutForm">
            @Html.AntiForgeryToken()

            <div class="mb-3">
                <label for="paymentMethod" class="form-label">Select Payment Method:</label>
                <select id="paymentMethod" name="paymentMethod" class="form-select" required>
                    <option value="COD">Cash on Delivery</option>
                    <option value="Stripe">Credit/Debit Card (Stripe)</option>
                </select>
            </div>

            <div id="creditCardNotice" class="alert alert-warning d-none">
                You’ll be redirected to Stripe’s secure checkout page.
            </div>

            <div class="mt-4">
                <h5 class="fw-bold">Order Summary</h5>
                <ul class="list-group mb-3">
                    @foreach (var item in Model)
                    {
                        <li class="list-group-item d-flex justify-content-between align-items-center">
                            <div>
                                <strong>@item.Service.ServiceName</strong><br />
                                <small>@item.Quantity × @item.Service.Price.ToString("C")</small>
                            </div>
                            <span>@(item.Quantity * item.Service.Price).ToString("C")</span>
                        </li>
                    }
                    <li class="list-group-item d-flex justify-content-between">
                        <strong>Total:</strong>
                        <strong>@grandTotal.ToString("C")</strong>
                    </li>
                </ul>
            </div>

            <div class="text-center">
                <button type="submit" class="btn btn-success btn-lg">Place Order</button>
            </div>
        </form>
    </div>
</div>

@section Scripts {
    <script>
        const paymentMethod = document.getElementById("paymentMethod");
        const creditCardNotice = document.getElementById("creditCardNotice");

        paymentMethod.addEventListener("change", function () {
            if (paymentMethod.value === "Stripe") {
                creditCardNotice.classList.remove("d-none");
            } else {
                creditCardNotice.classList.add("d-none");
            }
        });
    </script>
}
